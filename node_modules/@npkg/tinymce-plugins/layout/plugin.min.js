
 /**
 * layout 1.6v  2021-03-30
 * The tinymce-plugins is used to set up a layout
 * 
 * https://github.com/Five-great/tinymce-plugins
 * 
 * Copyright 2021, Five(Li Hailong) The Chengdu, China https://fivecc.cn/
 *
 * Licensed under MIT
 */
tinymce.PluginManager.add("layout",function(e,m){var y=tinymce.util.Tools.resolve("tinymce.util.Tools"),b=e.getParam("layout_options",{selection:"p,table,tr,td,h1,h2,h3,h4,h5,h6,ul,blockquote",learStyle:[],filterTags:["table>*"],style:{"text-align":"justify","text-indent":"2em","line-height":1.5},tagsStyle:{}}),f={},h={},n;for(n in b.filterTags)-1!=b.filterTags[n].indexOf(">*")?h[b.filterTags[n].replace(">*","").toUpperCase()]=!0:f[b.filterTags[n].toUpperCase()]=!0;for(var p in b.tagsStyle){m=p.split(",");
b.selection+=","+p;for(var u in m)-1!=m[u].indexOf(">*")?h[m[u].replace(">*","").toUpperCase()]=p:f[m[u].toUpperCase()]=p}var x=function(){function v(a,d){return(a=d.match(new RegExp(a+':?(.+?)"?[;}]')))?a[1]:!1}function w(a,d){var c=a.tagName;if(f[c]||h[c])return!b.tagsStyle[f[c]]||d?d?q(a,b.tagsStyle[f[c]]):"":r(a,b.tagsStyle[f[c]]),!0;for(var k=a.parentNode,l=k.tagName;"BODY"!==l;){c=l+">"+c;if(f[c]||h[l])return!b.tagsStyle[h[l]]||d?d?q(a,b.tagsStyle[h[l]]):"":r(a,b.tagsStyle[h[l]]),!b.tagsStyle[f[c]]||
d?d?q(a,b.tagsStyle[f[c]]):"":r(a,b.tagsStyle[f[c]]),!0;k=k.parentNode;l=k.tagName}return!1}function q(a,d){var c=g.getAttrib(a,"style"),k;for(k in d)c=c.replace(new RegExp(k+':?(.+?)"?[;}]'),"");g.setAttrib(a,"style",c)}function r(a,d){for(var c in d)g.setStyle(a,c,d[c]);d["text-indent"]&&(d="",a&&a.children["0"]&&a.children["0"].attributes&&a.children["0"].attributes.style&&(d=v("font-size",a.children["0"].attributes.style.textContent),c=v("letter-spacing",a.children["0"].attributes.style.textContent),
d=d?2*(parseInt(d)+parseInt(c?c:0))+"px":2*(parseInt(c?c:0)+16)+"px"),g.setStyle(a,"text-indent",b.style["text-indent"]&&"2em"!=b.style["text-indent"]?b.style["text-indent"]:d?d:"2em"))}var g=e.dom;e.execCommand("selectAll");b.selection=b.selection||"p,table,tr,td,h1,h2,h3,h4,h5,h6,ul,blockquote";for(var z in b.tagsStyle)b.selection+=","+z;blocks=e.selection.getNode().querySelectorAll(b.selection);var t="";y.each(blocks,function(a){""==t&&(g.hasClass(a,"layoutFV")?(t="remove",g.removeClass(a,"layoutFV")):
(t="add",g.addClass(a,"layoutFV")));if("add"==t)if(w(a)?"":r(a,b.style),b.clearStyle){var d=g.getAttrib(a,"style"),c;for(c in b.clearStyle)d=d.replace(new RegExp(b.clearStyle[c]+':?(.+?)"?[;}]'),"");g.setAttrib(a,"style",d)}else"";else w(a,"remove")?"":q(a,b.style)})};e.ui.registry.getAll().icons.layout||e.ui.registry.addIcon("layout",'<svg t="1603868236215" class="icon" viewBox="0 0 1035 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="17720" width="20" height="20"><path d="M357.445818 285.358545L1005.730909 518.830545c21.76 8.192 32.628364 31.394909 24.471273 51.87491a40.634182 40.634182 0 0 1-21.748364 23.214545l-245.992727 110.592a80.034909 80.034909 0 0 0-42.135273 42.321455l-104.657454 249.856c-8.145455 20.48-32.616727 30.045091-53.003637 21.85309-10.868364-4.096-19.025455-13.661091-23.098182-24.576L305.792 337.221818a40.075636 40.075636 0 0 1 24.471273-51.874909c8.145455-4.096 17.664-4.096 27.182545 0z m8.145455-255.32509v99.67709c0 16.384-13.579636 30.033455-29.893818 30.033455-16.302545 0-29.905455-13.649455-29.905455-30.033455V30.021818C305.803636 13.649455 319.406545 0 335.709091 0c16.314182 0 29.905455 13.649455 29.905454 30.033455zM29.905455 303.104h99.211636c16.302545 0 29.905455 13.649455 29.905454 30.033455s-13.602909 30.045091-29.905454 30.04509H29.905455C13.591273 363.170909 0 349.521455 0 333.137455s13.591273-30.033455 29.905455-30.033455zM645.573818 66.897455l-144.058182 144.73309c-12.241455 12.288-29.905455 12.288-42.135272 0-12.229818-12.288-12.229818-30.045091 0-42.33309l144.058181-144.721455c12.229818-12.288 29.905455-12.288 42.135273 0 10.868364 10.926545 10.868364 30.033455 0 42.321455zM67.944727 20.48L212.014545 165.201455c12.241455 12.288 12.241455 30.045091 0 42.33309-12.218182 12.288-29.905455 12.288-42.123636 0L25.832727 62.801455c-12.241455-12.288-12.241455-30.033455 0-42.321455 10.868364-12.288 29.893818-12.288 42.123637 0z m149.515637 480.593455L73.402182 645.818182c-12.241455 12.288-29.905455 12.288-42.146909 0-12.218182-12.288-12.218182-30.045091 0-42.333091l144.058182-144.721455c12.241455-12.288 29.905455-12.288 42.146909 0 12.218182 12.288 12.218182 30.033455 0 42.321455z" style="width:20px; height:20px" p-id="17721"></path></svg>');
e.ui.registry.addToggleButton("layout",{icon:"layout",tooltip:"\u4e00\u952e\u5e03\u5c40",onAction:function(){e.undoManager.transact(function(){e.focus();x()})}});e.ui.registry.addMenuItem("layout",{text:"\u4e00\u952e\u5e03\u5c40",onAction:function(){e.undoManager.transact(function(){e.focus();x()})}});return{getMetadata:function(){return{name:"\u4e00\u952e\u5e03\u5c40",url:"https://github.com/Five-great/tinymce-plugins"}}}});